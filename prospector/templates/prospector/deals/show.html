{% extends 'base.html' %}

{% load macros %}
{% load filters %}
{% load prospector_filters %}
{% loadmacros 'cooltable.html' %}
{% loadmacros 'show_data.html' %}

{% block title %}Deal : {{obj.booth_name}} à {{obj.event.name}}{% endblock %}
{% block subtitle %}Type : {{obj.get_type_display}}{% endblock %}
{% block active_menu %}deals{% endblock %}

{% block content %}
<div class="card mb-2">
    <div class="card-header">
        <div class="card-title h4">Tâches à faire pour ce deal</div>
        <div class="card-subtitle text-gray">
            Utilise cette table si tu veux t'occuper de ce deal.<br>
            Tu peux indiquer ta progression au fur et à mesure avec les boutons de droite.
        </div>
    </div>
    <div class="card-body">
        {% call cooltable qs.cols add_form=taskform %}
            <tr hidden id="tasktable_placeholder">
        {% endcall %}
    </div>
</div>

<div class="card mb-2">
    <div class="card-header">
        <div class="card-title h4">Données</div>
    </div>
    <div class="card-body">
        {% call showdata show_data %}{% endcall %}
        <div class="mt-2">
            <button class="btn">Mail données manquantes</button>
            <button class="btn btn-error">Supprimer</button>
            <button class="btn btn-primary">Éditer</button>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
    function loadList(){
        $.get('{% url "prospector:tasks.list_embed_fixed_deal" fixed_deal=obj.pk %}', function(response){
            $('#tasktable_placeholder').siblings().remove();
            $('#tasktable_placeholder').after(response);
            $('#state_buttons button').on('click', function(event){
                var button = $(event.target).closest('button')
                $.get(button.attr('link'), function(response){
                    loadList();
                });
            });
        });
    }

    loadList();
</script>
{% endblock %}
