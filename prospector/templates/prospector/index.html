{% extends 'base.html' %}

{% load macros %}
{% load prospector_filters %}
{% loadmacros 'cooltable.html' %}

{% block title %}Résumé{% endblock %}
{% block subtitle %}Survol rapide des choses importantes{% endblock %}

{% block content %}
<div class="app">
    <div class="card mb-2">
        <div class="card-header">
            <div class="card-title h4">Todo et échéances</div>
        </div>
        <div class="card-body">
            {% call cooltable 'to_do_table' to_do.cols %}
                {% for t in to_do.rows %}
                    <tr>
                        <td><a href="{% url 'prospector:tasks.show' pk=t.id %}">{{t.name}}</a></td>
                        <td>pour {{t.deal_count}} deals</td>
                        <td><span class="label label-{{t.worst_todo | todostatecolor}}">{{t.get_worst_todo_display}}</span></td>
                        <td><span class="label label-{{t.min_deadline | deadlinecolor}}">{{t.min_deadline | deadline}}</span> pour <a href="{% url 'prospector:deals.show' pk=t.min_booth_deal_id%}">{{t.min_booth_name}}</a></td>
                        <td>
                            <div>
                                <a href="{% url 'prospector:tasks.show' pk=t.id %}" class="btn btn-sm float-right">Voir</a>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% endcall %}
        </div>
    </div>

    <div class="card mb-2">
        <div class="card-header">
            <div class="card-title h4">Budget des stands</div>
        </div>
        <div class="card-body">
            <div class="container">
                <div class="columns m-medium">
                    <div class="col-6 text-center">
                        <small>BUDGET CERTAIN</small>
                        <p><span class="h3">CHF </span><span class="h3 text-success">+{{final_budget}}</span><span class="h4"> /1000</span></p>
                    </div>
                    <div class="col-6 text-center">
                        <small>BUDGET PREVISIONNEL</small>
                        <p><span class="h3">CHF </span><span class="h3 text-success">+{{unsure_budget}}</span><span class="h4"> /1000</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-2">
        <div class="card-header">
            <div class="card-title h4">Deals flottants</div>
        </div>
        <div class="card-body">
            {% call cooltable 'floating_deals_table' floating_deals.cols %}
                {% for d in floating_deals.rows %}
                    <tr>
                        <td>{{d.contact.booth_name}}</td>
                        <td>{{d.contact.person_name}}</td>
                        <td>{{d.contact.email_address}}</td>
                        <td><small>{{d.floating}}</small></td>
                        <td>
                            <div>
                                <button class="btn btn-sm float-right">Voir</button>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% endcall %}
        </div>
    </div>

    <div class="card mb-2">
        <div class="card-header">
            <div class="card-title h4">Emplacements libres</div>
        </div>
        <div class="card-body">
            {% call cooltable 'booths_table' free_booths.cols %}
                {% for b in free_booths.rows %}
                    <tr>
                        <td>{{b.name}}</td>
                        <td>{{b.building}}</td>
                        <td>CHF {{b.usual_price}}</td>
                        <td>
                            <div>
                                <button class="btn btn-sm float-right">Plan</button>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% endcall %}
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
    {% call cooltable_js 'to_do_table_json' 'to_do_table' to_do.cols %}{% endcall %}
    {% call cooltable_js 'booths_table_json' 'booths_table' free_booths.cols %}{% endcall %}
    {% call cooltable_js 'floating_deals_table_json' 'floating_deals_table' floating_deals.cols %}{% endcall %}
{% endblock %}
