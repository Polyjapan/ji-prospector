{% extends 'base.html' %}

{% load macros %}
{% load filters %}
{% load prospector_filters %}


{% block title %}Résumé{% endblock %}
{% block subtitle %}Survol rapide des choses importantes{% endblock %}
{% block active_menu %}index{% endblock %}

{% block content %}
<div class="app">
    <div hidden>
        Watcher les mails avec ton libellé, et te faire une notif quand un nouveau mail est arrivé
        Garder les threads mail d'un deal en mémoire, (ou même, les stocker par task, mais moins easy car je veux) annoncer si un nouveau thread
        mail a commencé, et du coup proposer un nouveau deal (ou une nouvelle task, mais c'est pas facile de détecter ça)
        <br>
        Check renvoi de contrat signé ??? S'il voit une pièce jointe nommée pareil que l'envoi, ou bien si c'est un pdf,
        Il te demande si c'est bien ça.
        <br>
        Peut-être proposer par défaut : "deal lié = nouveau or (select un existant => ça devine en fonction de l'expéditeur)" et puis
        "task liée = nouvelle or (select un TaskType)" et du coup ça lie le doc à la task(deal choisi, tasktype choisi)
        <br>
        Le trésorier peut laisser des commentaires sur les tâches, qui s'affichent quand tu les fais (dans les tasktype/list ou task/list)
        <br>
        Étendre à tout le monde, un système de commentaires soit sur un tasktype => propagé aux tasks, et aussi sur une task en particulier.
        quoique ce serait doublon du status flottant ?
        <br>
        Intégration truffe génération des factures. Check si le gars a payé too. Annulation des factures too
    </div>
    <form action="{% url 'prospector:quickstart' %}" method="get">
        <div class="card mb-2">
            <div class="card-header">
                <div class="card-title h4">Quick start</div>
                <div class="card-subtitle text-gray">
                    Entre un type de tâche ou le nom d'un deal pour y aller vite. (Ou bien, rien du tout).<br>
                </div>
            </div>
            <div class="card-body">
                {% for field in quickstartform %}
                    <div>{% if not field.is_hidden %}{{ field.errors }}{{ field }}{% endif %}</div>
                {% endfor %}
            </div>
            <div class="card-footer">
                <button type="submit" class="btn btn-primary float-right">Allez!</button>
            </div>
        </div>
    </form>
    <div class="card mb-2">
        <div class="card-header">
            <div class="container">
                <div class="columns">
                    <div class="column col-auto">
                        <div class="card-title h4">Tâches à faire groupées par type</div>
                    </div>
                    <div class="column col">
                        <input class="search form-input" placeholder="Rechercher" id="tasks_table_search"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">
            <nicetable id="tasks_table">
                <rows>
                    {% for r in to_do %}
                        <r>
                            {% with late=r.deadline|past %}
                            <d>{% if late %}Il fallait {% else %}Il faut {% endif %}<a href="{% url 'prospector:tasktypes.show' pk=r.id %}">{{r.name | lower}}</a></d>
                            <d><small>pour {{r.deal_count}} deals</small></d>
                            <d><small>{{r.deadline | deadline | orcross}}</small> pour <a href="{% url 'prospector:deals.show' pk=r.deal_id%}">{{r.booth_name}}</a></d>
                            <d><small class="label label-{{r.worst_todo | todostatecolor}}">{{r.get_worst_todo_display}}</small></d>
                            <d>
                            </d>
                            {% endwith %}
                        </r>
                    {% endfor %}
                </rows>
            </nicetable>
        </div>
    </div>

    <div class="card mb-2">
        <div class="card-header">
            <div class="card-title h4">Budget des stands</div>
        </div>
        <div class="card-body">
            <div class="container">
                faire couleur du budget juste
                <div class="columns m-medium">
                    <div class="col-6 text-center">
                        <small>BUDGET CERTAIN</small>
                        <p><span class="h3">CHF </span><span class="h3 text-success">+{{final_budget}}</span><span class="h4"> /1000</span></p>
                    </div>
                    <div class="col-6 text-center">
                        <small>BUDGET PREVISIONNEL</small>
                        <p><span class="h3">CHF </span><span class="h3 text-success">+{{unsure_budget}}</span><span class="h4"> /1000</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-2">
        <div class="card-header">
            <div class="card-title h4">Emplacements libres</div>
        </div>
        <div class="card-body">
            <nicetable id="free_booths_table">
                <rows>
                    {% for b in free_booths %}
                        <r>
                            <d>{{b.name}}linker plan centré</d>
                            <d>{{b.building}}linker plan cm</d>
                            <d>{{b.get_usual_price_display}}</d>
                            <d>prix des deals placés ici de manière pas sûre</d>
                            <d>
                                <div>
                                    <button class="btn btn-sm float-right">Détails emplacement</button>lien show emplacement
                                </div>
                            </d>
                        </r>
                    {% endfor %}
                </rows>
            </nicetable>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
    var t = new NiceTable($('#tasks_table'), ['Type de tâche', '', '1ère deadline', 'Pire état']);
    t.setSearchBox($('#tasks_table_search'))
    var t2 = new NiceTable($('#free_booths_table'), ['Emplacement', 'Bâtiment', 'Prix usuel', 'Prix des deals qui vont peut-être ici', '<search>']);
</script>
{% endblock %}
